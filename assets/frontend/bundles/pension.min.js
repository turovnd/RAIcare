var pension=function(e){function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=42)}({25:function(e,n){e.exports=function(e){function n(){var e=document.getElementById("excludeForm"),n=new FormData;n.append("user",r),n.append("pension",document.getElementById("pensionID").value),n.append("csrf",document.getElementById("csrf").value);var t={url:"/pension/excludeuser",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,a),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),143===parseInt(n.code)&&(s.remove(),i.close(),i=null)},error:function(n){raicare.core.log("ajax error occur on excluding coworker","error",a,n),e.classList.remove("loading")}};raicare.ajax.send(t)}function t(){for(var e=JSON.parse(document.getElementById("availableRoles").value),n='<option value="new">Новая</option>',t=0;t<e.length;t++)n+='<option value="'+e[t].id+'">'+e[t].name+"</option>";return n}function o(){for(var e=JSON.parse(document.getElementById("availablePermissions").value),n="",t=0;t<e.length;t++)n+='<p><input type="checkbox" id="modalpermission_'+e[t].id+'" class="checkbox"><label for="modalpermission_'+e[t].id+'" class="checkbox-label">'+e[t].name+"</label></p>";return n}var a="Pension: coworker",r=null,s=null,i=null,l=null;return e.invite=function(){for(var e=document.getElementById("inviteCoWorkerModal"),n=new FormData,t=document.getElementById("inviteCoWorkerPermissions").querySelectorAll(".checkbox:checked"),o=[],r=0;r<t.length;r++)o.push(t[r].id.split("_")[1]);n.append("name",document.getElementById("inviteCoWorkerName").value),n.append("email",document.getElementById("inviteCoWorkerEmail").value),n.append("pension",document.getElementById("pensionID").value),n.append("role",document.getElementById("inviteCoWorkerRole").value),n.append("roleName",document.getElementById("inviteCoWorkerRoleName").value),n.append("permissions",JSON.stringify(o)),n.append("csrf",document.getElementById("csrf").value);var s={url:"/pension/inviteuser",type:"POST",data:n,beforeSend:function(){e.getElementsByClassName("modal__content")[0].classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,a),e.getElementsByClassName("modal__content")[0].classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),62===parseInt(n.code)&&raicare.modal.hide(e)},error:function(n){raicare.core.log("ajax error occur on inviting coworker","error",a,n),e.getElementsByClassName("modal__content")[0].classList.remove("loading")}};raicare.ajax.send(s)},e.exclude=function(e){r=e.dataset.pk,s=e.parentNode;var t=e.dataset.name;i=raicare.notification.notify({type:"confirm",message:'<div id="excludeForm"><h2>Исключить сотрудника</h2><p>Вы уверены, то хотите исключить '+t+"?</p><p>Исключив сотрудника, у него больше не будет доступа к пансионту.</p></div>",confirmText:"Исключить",showCancelButton:!0,validation:!0,confirm:n,cancel:function(){r=null}})},e.openupdaterole=function(e){l=e.parentNode.getElementsByClassName("label")[0],raicare.modal.create({id:"updateCoWorkerModal",header:"Изменить роль сотрудника",body:'<fieldset><div class="form-group"><label for="updateCoWorkerRole" class="form-group__label">Роль</label><select name="role" id="updateCoWorkerRole" data-pk="'+e.dataset.pk+'" class="form-group__control" onchange="pension.coworker.changerole(this)" data-permissions="updateCoWorkerPermissions" data-rolename="updateCoWorkerRoleName">'+t()+'</select></div></fieldset><fieldset><div class="form-group"><label for="updateCoWorkerRoleName" class="form-group__label">Название новой роли</label><input type="text" id="updateCoWorkerRoleName" class="form-group__control" maxlength="64"></div></fieldset><fieldset id="updateCoWorkerPermissions" class="m-b-0"><div class="form-group">'+o()+"</div></fieldset>",footer:'<button type="button" class="btn btn--default" data-close="modal">Отмена</button><button onclick="pension.coworker.updaterole()" type="button" class="btn btn--brand">Изменить</button>',onclose:"destroy"})},e.updaterole=function(){for(var e=document.getElementById("updateCoWorkerModal"),n=new FormData(e),t=document.getElementById("updateCoWorkerPermissions").querySelectorAll(".checkbox:checked"),o=[],r=0;r<t.length;r++)o.push(t[r].id.split("_")[1]);n.append("pension",document.getElementById("pensionID").value),n.append("role",document.getElementById("updateCoWorkerRole").value),n.append("type","pension"),n.append("roleName",document.getElementById("updateCoWorkerRoleName").value),n.append("permissions",JSON.stringify(o)),n.append("user",document.getElementById("updateCoWorkerRole").dataset.pk),n.append("csrf",document.getElementById("csrf").value);var s={url:"/profile/changerole",type:"POST",data:n,beforeSend:function(){e.getElementsByClassName("modal__content")[0].classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,a),e.getElementsByClassName("modal__content")[0].classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),53===parseInt(n.code)&&(raicare.modal.destroy(e),l.textContent=n.role.name,l=null)},error:function(n){raicare.core.log("ajax error occur on changing coworker role","error",a,n),e.getElementsByClassName("modal__content")[0].classList.remove("loading")}};raicare.ajax.send(s)},e.changerole=function(e){"new"===e.value?(document.getElementById(e.dataset.permissions).classList.remove("hide"),document.getElementById(e.dataset.rolename).parentNode.parentNode.classList.remove("hide")):(document.getElementById(e.dataset.permissions).classList.add("hide"),document.getElementById(e.dataset.rolename).parentNode.parentNode.classList.add("hide"))},e}({})},26:function(e,n){e.exports=function(e){return e.toggle=function(e){var n=e.closest(".js-field-name");n.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),n.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide")},e.save=function(e){var n=document.getElementById("pension"),t=e.closest(".js-field-name"),o=t.getElementsByClassName("form-group__control")[0].value,a=t.getElementsByClassName("form-group__control")[0].name,r=new FormData;r.append("id",document.getElementById("pensionID").value),r.append("csrf",document.getElementById("csrf").value),r.append("name",a),r.append("value",o);var s={url:"/pension/update",type:"POST",data:r,beforeSend:function(){n.classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,"Pension: edit info"),n.classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),144===parseInt(e.code)&&(t.getElementsByClassName("js-pension-info")[0].textContent=o,t.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),t.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide"))},error:function(e){raicare.core.log("ajax error occur on updating pension info","error","Pension: edit info",e),n.classList.remove("loading")}};raicare.ajax.send(s)},e.cover=function(e){var n=document.getElementById("pensionCover");raicare.transport.init({url:"/transport/2",params:{id:e.dataset.pk},beforeSend:function(){var e=new FileReader,t=raicare.transport.getInput(),o=t.files[0];e.readAsDataURL(o),e.onload=function(e){n.classList.add("image--loading"),n.src=e.target.result}},success:function(e){e=JSON.parse(e),88===parseInt(e.code)?(n.src=e.url,n.classList.remove("image--loading")):raicare.notification.notify({type:e.status,message:e.message})},error:function(e){return raicare.core.log("ajax error occur on updating pension cover","error","Pension: edit info",e),!1}})},e}({})},27:function(e,n){e.exports=function(e){function n(){a=new FormData,s=c.dataset.offset,r=c.dataset.type;var e=i;a.append("name",i),a.append("type",r),a.append("offset",s),a.append("csrf",document.getElementById("csrf").value);var n={url:"/pension/get",type:"POST",data:a,beforeSend:function(){d=!0,c.innerHTML="Загрузка ..."},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,o),d=!1,146===parseInt(n.code)?(a=null,c.innerHTML="Загрузить ещё",""!==n.html?(c.dataset.offset=parseInt(s)+parseInt(n.number),i===e?l.innerHTML+=n.html:l.innerHTML=n.html):(c.innerHTML="Всего "+parseInt(parseInt(s)+parseInt(n.number)),document.removeEventListener("scroll",t))):(c.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",raicare.notification.notify({type:n.status,message:n.message}))},error:function(e){raicare.core.log("ajax error occur on getting organizations","error",o,e),c.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",d=!1}};raicare.ajax.send(n)}function t(){var e=l.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===d&&n()}var o="Pension: get AJAX",a=null,r=null,s=null,i="",l=document.getElementById("pensions"),c=document.getElementById("getMoreBtn"),d=!1;return e.search=function(e){i=e.value,d||(c.dataset.offset=0,l.innerHTML="",n())},e.blocks=function(e){c=e,d||(n(),document.addEventListener("scroll",t))},e}({})},42:function(e,n,t){e.exports=function(e){return e.edit=t(26),e.coworker=t(25),e.get=t(27),e}({})}});