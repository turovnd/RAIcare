var survey=function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=47)}({32:function(e,t){e.exports=function(e){function t(){var t=window.location.hash.replace("#",""),n=null;""===t&&(t="progress"),n="progress"===t?"":t,n=document.querySelector('.aside__link[href="#'+n+'"]'),e.unit(n,t)}function n(e){return-1!==m.indexOf(e)||(raicare.notification.notify({type:"error",message:"Не правильно указан адрес"}),!1)}function a(e){var t=new FormData;t.append("unit",e),t.append("survey",p),t.append("pension",d),t.append("csrf",document.getElementById("csrf").value);var n={url:"/survey/getunit",type:"POST",data:t,beforeSend:function(){document.getElementsByClassName("wrapper")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,c),document.getElementsByClassName("wrapper")[0].classList.remove("loading"),165===parseInt(e.code)?(l.innerHTML=e.html,survey.table.init(),raicare.loader.init(),i()):raicare.notification.notify({type:e.status,message:e.message})},error:function(e){raicare.core.log("ajax error occur on getting unit of survey","error",c,e),document.getElementsByClassName("wrapper")[0].classList.remove("loading")}};raicare.ajax.send(n)}function r(){var e=new FormData,t=parseInt(v.dataset.offset);e.append("offset",t),e.append("patient",u),e.append("pension",d),e.append("csrf",document.getElementById("csrf").value);var n={url:"/survey/get",type:"POST",data:e,beforeSend:function(){f=!0,v.getElementsByClassName("fa")[0].classList.remove("fa-plus"),v.getElementsByClassName("fa")[0].classList.add("fa-spinner","fa-fw","fa-pulse")},success:function(e){if(e=JSON.parse(e),raicare.core.log(e.message,e.status,c),f=!1,v.getElementsByClassName("fa")[0].classList.add("fa-plus"),v.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse"),162===parseInt(e.code))if(0!==e.surveys.length){for(var n=null,a=null,r=null,s=0;s<e.surveys.length;s++){n=document.querySelectorAll("[data-datetime]"),n=new Date(n[n.length-1].dataset.datetime),r=new Date(e.surveys[s].date),r-n!=0&&(a=raicare.draw.node("LI","time-line__separator",{"data-datetime":e.surveys[s].date}),g.insertBefore(a,g.getElementsByClassName("time-line__end")[0]));var o=raicare.draw.node("LI","time-line__item"+((t+s)%2==0?"":" time-line__item--inverted"));o.innerHTML=e.surveys[s].html,g.insertBefore(o,g.getElementsByClassName("time-line__end")[0])}v.dataset.offset=parseInt(t)+parseInt(e.number)}else v.parentNode.remove();else raicare.notification.notify({type:e.status,message:e.message})},error:function(e){raicare.core.log("ajax error occur on getting patients","error",c,e),f=!1,v.getElementsByClassName("fa")[0].classList.add("fa-plus"),v.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse")}};raicare.ajax.send(n)}function s(){var e=y.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===f&&o()}function o(){var e=new FormData,t=h.dataset.offset,n=E;e.append("name",n),e.append("offset",t),e.append("csrf",document.getElementById("csrf").value);var a={url:"/survey/search",type:"POST",data:e,beforeSend:function(){f=!0,h.innerHTML="Загрузка ..."},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,c),f=!1,162===parseInt(e.code)?(h.innerHTML="Загрузить ещё",""!==e.html?(h.dataset.offset=parseInt(t)+parseInt(e.number),E===n?y.innerHTML+=e.html:y.innerHTML=e.html):(h.innerHTML="Всего "+parseInt(parseInt(t)+parseInt(e.number)),document.removeEventListener("scroll",s))):(h.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",document.removeEventListener("scroll",s),raicare.notification.notify({type:e.status,message:e.message}))},error:function(e){raicare.core.log("ajax error occur on searching surveys","error",c,e),h.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",document.removeEventListener("scroll",s),f=!1}};raicare.ajax.send(a)}function i(){if(document.getElementsByClassName("js-single-select").length>0&&new raicare.choices(".js-single-select",{shouldSort:!1,searchEnabled:!1,itemSelectText:"выбрать"}),document.getElementById("I2")){var e=new raicare.choices(document.getElementById("I2"),{removeItemButton:!0,placeholderValue:"Введите названия диагноза или код МКБ-10",loadingText:"Загрузка...",noResultsText:"Ничего не найдено",noChoicesText:"Нет элементов для выбора",itemSelectText:"выбрать",searchEnabled:!0,searchFloor:2,searchResultLimit:30,resetScrollPosition:!1});e.passedElement.addEventListener("search",function(t){e.clearStore(),e.ajax(function(e){fetch("/mkb10/get?name="+t.detail.value).then(function(t){t.json().then(function(t){e(t,"value","label")})}).catch(function(e){console.log(e)})})},!1)}}var c="Survey: get AJAX",l=document.getElementsByClassName("section__content")[0],d=document.getElementById("pensionID"),u=document.getElementById("patientPK"),m=["progress","unitA","unitB","unitC","unitD","unitE","unitF","unitG","unitH","unitI","unitJ","unitK","unitL","unitM","unitN","unitO","unitP","unitQ","unitR"],p=document.getElementById("surveyID"),f=!1;d&&(d=d.value),u&&(u=u.value),p&&(p=p.value),e.unitstart=function(){var e=document.getElementById("unavailableUnits");if(e){e=JSON.parse(e.value);for(var n=0;n<e.length;n++){m.splice(m.indexOf(e[n]),1);var a=document.querySelector(".aside__link[href='#"+e[n]+"']");a&&a.parentNode.remove()}window.addEventListener("hashchange",t),t()}},e.unit=function(e,t){n(t)&&(document.getElementsByClassName("aside__item--active")[0]&&document.getElementsByClassName("aside__item--active")[0].classList.remove("aside__item--active"),document.getElementsByClassName("aside__link--active")[0]&&document.getElementsByClassName("aside__link--active")[0].classList.remove("aside__link--active"),e.parentNode.classList.add("aside__item--active"),e.classList.add("aside__link--active"),a(t))};var g=null,v=null;e.timeLineItems=function(){g&&v||(v=document.getElementById("getMoreSurveysBtn"),g=document.getElementById("timeline")),f||r()};var y=document.getElementById("surveys"),E="",h=document.getElementById("getMoreBtn");return e.search=function(e){E=e.value,f||(h.dataset.offset=0,y.innerHTML="",o())},e.surveys=function(e){h=e,f||(o(),document.addEventListener("scroll",s))},e}({})},33:function(e,t){e.exports=function(e){function t(){var e=s.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===r&&n()}function n(){var e=new FormData,n=i.dataset.offset,s=i.dataset.pension;e.append("offset",n),e.append("pension",s),e.append("csrf",document.getElementById("csrf").value);var c={url:"/survey/load",type:"POST",data:e,beforeSend:function(){r=!0,i.innerHTML="Загрузка ..."},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,a),r=!1,162===parseInt(e.code)?(i.innerHTML="Загрузить ещё",""!==e.html?(i.dataset.offset=parseInt(n)+parseInt(e.number),o.innerHTML+=e.html,raicare.table.create()):(i.innerHTML="Всего "+parseInt(parseInt(n)+parseInt(e.number)),i.classList.add("pointer-events--none"),document.removeEventListener("scroll",t))):(i.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",i.classList.remove("pointer-events--none"),document.removeEventListener("scroll",t),raicare.notification.notify({type:e.status,message:e.message}))},error:function(e){raicare.core.log("ajax error occur on searching surveys","error",a,e),i.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",document.removeEventListener("scroll",t),r=!1}};raicare.ajax.send(c)}var a="Survey: load AJAX",r=!1,s=null,o=null,i=null;return e.init=function(){o=document.getElementById("allSurveyItems"),s=document.getElementById("surveys"),i=document.getElementById("loadMoreBtn")},e.surveys=function(e){r||(n(),document.addEventListener("scroll",t))},e}({})},34:function(e,t){e.exports=function(e){var t="Survey: send AJAX",n=document.getElementById("surveyID"),a=document.getElementById("pensionID");return n&&(n=n.value),a&&(a=a.value),e.updateunit=function(e){var r=document.getElementById(e);if(r){var s=new FormData(r);s.append("unit",e),s.append("survey",n),s.append("pension",a),s.append("csrf",document.getElementById("csrf").value);var o={url:"/survey/updateunit",type:"POST",data:s,beforeSend:function(){r.getElementsByClassName("form")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,t),r.getElementsByClassName("form")[0].classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),169===parseInt(e.code)&&window.location.reload()},error:function(e){raicare.core.log("ajax error occur on updating unit data","error",t,e),r.getElementsByClassName("form")[0].classList.remove("loading")}};raicare.ajax.send(o)}},e.newpatientform=function(){var e=document.getElementById("newPatientModalForm"),n=new FormData(e);n.append("pension",a),n.append("csrf",document.getElementById("csrf").value);var r={url:"/patient/new",type:"POST",data:n,beforeSend:function(){e.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,t),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),151===parseInt(n.code)&&(raicare.modal.hide(e),window.location.assign("survey/"+n.id))},error:function(n){raicare.core.log("ajax error occur on sending new patient form","error",t,n),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raicare.ajax.send(r)},e.newpatientformwithtype=function(e){var n=new FormData,r=e.dataset.pk,s=e.dataset.area,o=document.getElementById(s).getElementsByClassName("js-form-type")[0].value,i=e.parentNode;if(""===o)return void raicare.notification.notify({type:"error",message:"Пожалуйста выберите причина прохождения оценки пациентом"});n.append("pension",a),n.append("patient",r),n.append("type",o),n.append("csrf",document.getElementById("csrf").value);var c={url:"/survey/new",type:"POST",data:n,beforeSend:function(){i.classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,t),i.classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),161===parseInt(e.code)&&window.location.assign("survey/"+e.id)},error:function(e){raicare.core.log("ajax error occur on sending new patient form","error",t,e),i.classList.remove("loading")}};raicare.ajax.send(c)},e.complete=function(){var e=document.body,r=new FormData;r.append("survey",n),r.append("pension",a),r.append("csrf",document.getElementById("csrf").value);var s={url:"/survey/complete",type:"POST",data:r,beforeSend:function(){e.classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,t),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),169===parseInt(n.code)&&window.location.reload()},error:function(n){raicare.core.log("ajax error occur on sending complete survey","error",t,n),e.classList.remove("loading")}};raicare.ajax.send(s)},e}({})},35:function(e,t){e.exports=function(e){function t(e){for(var t="",n=0;n<e.length;n++)t+='<option value="'+n+'"> '+e[n]+" </option>";return t}function n(e){for(var t="",n=0;n<e.length;n++){for(var a=e[n].querySelectorAll(".form-group__control"),r=0;r<e.length;r++)a[r].name="N1["+n+"]["+r+"]";e[n].querySelector(".checkbox").dataset.row=n,t+=e[n].innerHTML}return t}return e.init=function(){!function(e){(0,e.shoestring)(document).trigger("enhance.tablesaw")}("undefined"!=typeof window?window:this)},e.addRow=function(e){var n=document.getElementById(e),a=n.getElementsByTagName("tbody")[0],r=a.getElementsByTagName("tr").length,s=raicare.draw.node("TR"),o=JSON.parse(document.getElementById("N1cOptions").value),i=JSON.parse(document.getElementById("N1dOptions").value),c=JSON.parse(document.getElementById("N1eOptions").value);s.innerHTML='<td width="30%"> <div class="form-group"><select name="N1['+r+'][0]" class="form-group__control"><option selected value="-1">Не выбрано</option></select></div> </td><td width="13%"> <div class="form-group"><input name="N1['+r+'][1]" type="number" min="0" step=".01" class="form-group__control"></div> </td><td width="13%"> <div class="form-group"><select name="N1['+r+'][2]" class="form-group__control"><option selected disabled value="-1">Не выбрано</option>'+t(o)+'</select></div> </td><td width="13%"> <div class="form-group"><select name="N1['+r+'][3]" class="form-group__control"><option selected disabled value="-1">Не выбрано</option>'+t(i)+'</select></div> </td><td width="13%"> <div class="form-group"><select name="N1['+r+'][4]" class="form-group__control"><option selected disabled value="-1">Не выбрано</option>'+t(c)+'</select></div> </td><td width="13%"> <div class="form-group"><select name="N1['+r+'][5]" class="form-group__control"><option selected disabled value="-1">Не выбрано</option><option value="1">Да</option><option value="0">Нет</option></select></div> </td><td width="5%"><input id="N1_checkbox'+r+'" class="checkbox" type="checkbox" data-row="'+r+'"><label for="N1_checkbox'+r+'" class="checkbox-label"></label></td>',a.appendChild(s)},e.removeRow=function(e){var t=document.getElementById(e),a=t.getElementsByTagName("tbody")[0],r=a.getElementsByTagName("tr"),s=a.querySelectorAll(".checkbox:checked");if(0!==s.length){for(var o=s.length-1;o>=0;o--)r[s[o].dataset.row].remove();a=0===r.length?"":n(r)}},e}({})},47:function(e,t,n){e.exports=function(e){return e.get=n(32),e.send=n(34),e.table=n(35),e.load=n(33),e}({})}});