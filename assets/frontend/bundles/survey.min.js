var survey=function(e){function t(a){if(n[a])return n[a].exports;var s=n[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=47)}({32:function(e,t){e.exports=function(e){function t(){var t=window.location.hash.replace("#",""),n=null;""===t&&(t="progress"),n="progress"===t?"":t,n=document.querySelector('.aside__link[href="#'+n+'"]'),e.unit(n,t)}function n(e){return-1!==u.indexOf(e)||(raicare.notification.notify({type:"error",message:"Не правильно указан адрес"}),!1)}function a(e){var t=new FormData;t.append("unit",e),t.append("survey",d),t.append("pension",l),t.append("csrf",document.getElementById("csrf").value);var n={url:"/survey/getunit",type:"POST",data:t,beforeSend:function(){document.getElementsByClassName("wrapper")[0].classList.add("loading")},success:function(t){t=JSON.parse(t),raicare.core.log(t.message,t.status,o),document.getElementsByClassName("wrapper")[0].classList.remove("loading"),165===parseInt(t.code)?(i.innerHTML=t.html,"progress"===e&&(survey.table.initProgressTable(),raicare.loader.init()),r()):raicare.notification.notify({type:t.status,message:t.message})},error:function(e){raicare.core.log("ajax error occur on getting unit of survey","error",o,e),document.getElementsByClassName("wrapper")[0].classList.remove("loading")}};raicare.ajax.send(n)}function s(){var e=new FormData,t=parseInt(f.dataset.offset);e.append("offset",t),e.append("patient",c),e.append("pension",l),e.append("csrf",document.getElementById("csrf").value);var n={url:"/survey/get",type:"POST",data:e,beforeSend:function(){m=!0,f.getElementsByClassName("fa")[0].classList.remove("fa-plus"),f.getElementsByClassName("fa")[0].classList.add("fa-spinner","fa-fw","fa-pulse")},success:function(e){if(e=JSON.parse(e),raicare.core.log(e.message,e.status,o),m=!1,f.getElementsByClassName("fa")[0].classList.add("fa-plus"),f.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse"),162===parseInt(e.code))if(0!==e.surveys.length){for(var n=null,a=null,s=null,r=0;r<e.surveys.length;r++){n=document.querySelectorAll("[data-datetime]"),n=new Date(n[n.length-1].dataset.datetime),s=new Date(e.surveys[r].date),s-n!=0&&(a=raicare.draw.node("LI","time-line__separator",{"data-datetime":e.surveys[r].date}),p.insertBefore(a,p.getElementsByClassName("time-line__end")[0]));var i=raicare.draw.node("LI","time-line__item"+((t+r)%2==0?"":" time-line__item--inverted"));i.innerHTML=e.surveys[r].html,p.insertBefore(i,p.getElementsByClassName("time-line__end")[0])}f.dataset.offset=parseInt(t)+parseInt(e.number)}else f.parentNode.remove();else raicare.notification.notify({type:e.status,message:e.message})},error:function(e){raicare.core.log("ajax error occur on getting patients","error",o,e),m=!1,f.getElementsByClassName("fa")[0].classList.add("fa-plus"),f.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse")}};raicare.ajax.send(n)}function r(){if(document.getElementsByClassName("js-single-select").length>0&&new raicare.choices(".js-single-select",{shouldSort:!1,searchEnabled:!1,itemSelectText:"выбрать"}),document.getElementById("I2")){var e=new raicare.choices(document.getElementById("I2"),{removeItemButton:!0,placeholderValue:"Введите названия диагноза или код МКБ-10",loadingText:"Загрузка...",noResultsText:"Ничего не найдено",noChoicesText:"Нет элементов для выбора",itemSelectText:"выбрать",searchEnabled:!0,searchFloor:2,searchResultLimit:30,resetScrollPosition:!1});e.passedElement.addEventListener("search",function(t){e.clearStore(),e.ajax(function(e){fetch("/mkb10/get?name="+t.detail.value).then(function(t){t.json().then(function(t){e(t,"value","label")})}).catch(function(e){console.log(e)})})},!1)}}var o="Survey: get AJAX",i=document.getElementsByClassName("section__content")[0],l=document.getElementById("pensionID"),c=document.getElementById("patientPK"),u=["progress","unitA","unitB","unitC","unitD","unitE","unitF","unitG","unitH","unitI","unitJ","unitK","unitL","unitM","unitN","unitO","unitP","unitQ","unitR"],d=document.getElementById("surveyID"),m=!1;l&&(l=l.value),c&&(c=c.value),d&&(d=d.value),e.unitstart=function(){var e=document.getElementById("unavailableUnits");if(e){e=JSON.parse(e.value);for(var n=0;n<e.length;n++){u.splice(u.indexOf(e[n]),1);var a=document.querySelector(".aside__link[href='#"+e[n]+"']");a&&a.parentNode.remove()}window.addEventListener("hashchange",t),t()}},e.unit=function(e,t){n(t)&&(document.getElementsByClassName("aside__item--active")[0]&&document.getElementsByClassName("aside__item--active")[0].classList.remove("aside__item--active"),document.getElementsByClassName("aside__link--active")[0]&&document.getElementsByClassName("aside__link--active")[0].classList.remove("aside__link--active"),e.parentNode.classList.add("aside__item--active"),e.classList.add("aside__link--active"),a(t))};var p=null,f=null;return e.timeLineItems=function(){p&&f||(f=document.getElementById("getMoreSurveysBtn"),p=document.getElementById("timeline")),m||s()},e}({})},33:function(e,t){e.exports=function(e){function t(){var e=r.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===s&&n()}function n(){var e=new FormData,n=i.dataset.offset,r=i.dataset.pension;e.append("offset",n),e.append("pension",r),e.append("csrf",document.getElementById("csrf").value);var l={url:"/survey/load",type:"POST",data:e,beforeSend:function(){s=!0,i.innerHTML="Загрузка ..."},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,a),s=!1,162===parseInt(e.code)?(i.innerHTML="Загрузить ещё",""!==e.html?(i.dataset.offset=parseInt(n)+parseInt(e.number),o.innerHTML+=e.html,raicare.table.create()):(i.innerHTML="Всего "+parseInt(parseInt(n)+parseInt(e.number)),i.classList.add("pointer-events--none"),document.removeEventListener("scroll",t))):(i.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",i.classList.remove("pointer-events--none"),document.removeEventListener("scroll",t),raicare.notification.notify({type:e.status,message:e.message}))},error:function(e){raicare.core.log("ajax error occur on searching surveys","error",a,e),i.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",document.removeEventListener("scroll",t),s=!1}};raicare.ajax.send(l)}var a="Survey: load AJAX",s=!1,r=null,o=null,i=null;return e.init=function(){o=document.getElementById("allSurveyItems"),r=document.getElementById("surveys"),i=document.getElementById("loadMoreBtn")},e.surveys=function(e){s||(n(),document.addEventListener("scroll",t))},e}({})},34:function(e,t){e.exports=function(e){function t(e){e.preventDefault();var t=document.getElementById("newSurveyModalForm"),s=new FormData(t);s.append("pension",a),s.append("patient",r),s.append("csrf",document.getElementById("csrf").value);var o={url:"/survey/new",type:"POST",data:s,beforeSend:function(){t.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,n),t.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),161===parseInt(e.code)&&window.location.assign("survey/"+e.id)},error:function(e){raicare.core.log("ajax error occur on sending new patient form","error",n,e),t.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raicare.ajax.send(o)}var n="Survey: new",a=null,s=null,r=null;return e.init=function(){a=document.getElementById("pensionID"),s=document.getElementById("surveyReasonOptions"),a&&(a=a.value),s&&(s=s.dataset.html)},e.createModal=function(e){r=e.dataset.pk,raicare.modal.create({node:"FORM",id:"newSurveyModalForm",header:"Причина прохождения оценки",body:'<div class="row"><label for="surveyReason" class="col-xs-12 form-group__label">Укажите причину прохождения анкетирования</label><div class="col-xs-12"><select id="surveyReason" name="type" class="form-group__control js-single-select"><option value="-1" disabled selected>Не выбрано</option>'+s+'</select></div></div><button type="submit" class="btn btn--lg btn--brand fl_r m-t-20 m-r-0">Создать</button>',onclose:"remove"}),raicare.select.init(),document.getElementById("newSurveyModalForm").addEventListener("submit",t)},e}({})},35:function(e,t){e.exports=function(e){var t="Survey: send AJAX",n=document.getElementById("surveyID"),a=document.getElementById("pensionID"),s=document.getElementById("pensionURI");return n&&(n=n.value),a&&(a=a.value),s&&(s=s.value),e.updateunit=function(e){var s=document.getElementById(e);if(s){var r=new FormData(s);r.append("unit",e),r.append("survey",n),r.append("pension",a),r.append("csrf",document.getElementById("csrf").value);var o={url:"/survey/updateunit",type:"POST",data:r,beforeSend:function(){s.getElementsByClassName("form")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,t),s.getElementsByClassName("form")[0].classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),169===parseInt(e.code)&&window.location.reload()},error:function(e){raicare.core.log("ajax error occur on updating unit data","error",t,e),s.getElementsByClassName("form")[0].classList.remove("loading")}};raicare.ajax.send(o)}},e.complete=function(){var e=document.body,r=new FormData;r.append("survey",n),r.append("pension",a),r.append("csrf",document.getElementById("csrf").value);var o={url:"/survey/complete",type:"POST",data:r,beforeSend:function(){e.classList.add("loading")},success:function(a){a=JSON.parse(a),raicare.core.log(a.message,a.status,t),e.classList.remove("loading"),raicare.notification.notify({type:a.status,message:a.message}),169===parseInt(a.code)&&window.location.assign("/"+s+"/report/"+n+"/status")},error:function(n){raicare.core.log("ajax error occur on sending complete survey","error",t,n),e.classList.remove("loading")}};raicare.ajax.send(o)},e}({})},36:function(e,t){e.exports=function(e){var t=document.getElementById("surveysHistory"),n=document.getElementById("surveyProgress");return e.initProgressTable=function(){var e=new DataTable("#surveyProgress",{perPage:20,searchable:!1,sortable:!0,footer:!0});e.wrapper.getElementsByClassName("dataTable-top")[0].remove(),e.wrapper.getElementsByClassName("dataTable-bottom")[0].remove()},t&&function(){raicare.moment.setLocale(),raicare.moment.createDate("CLASS","js-date",!0),raicare.moment.createDateFromNow("CLASS","js-data-fromNow"),t=new DataTable("#surveysHistory",{perPage:1e3,searchable:!1,sortable:!0,labels:{placeholder:"Поиск...",perPage:"{select} отчетов на странице",noRows:"Отчеты не найдены",info:"Показано с {start} по {end} из {rows}"},nextPrev:!1});var e=document.getElementById("openCompareBtn"),n=document.getElementById("checkAll"),a=[].slice.call(t.body.getElementsByClassName("checkbox")),s=document.getElementById("compareBtn"),r=function(){"false"===e.dataset.opened?(t.columns().hide([4]),t.columns().show([5])):(t.columns().show([4]),t.columns().hide([5])),i()},o=function(e){var t=e.target;if(t===n)for(var s=0;s<a.length;s++)a[s].checked=t.checked,a[s].parentNode.parentNode.classList.toggle("selected",t.checked);else t.parentNode.parentNode.classList.toggle("selected",t.checked)},i=function(){n.checked=!1,a=[].slice.call(t.body.getElementsByClassName("checkbox"))},l=function(){var e=t.body.querySelectorAll("input:checked"),n=[];e.length?(e.forEach(function(e,t){n[t]=e.value}),console.log("Compare: "+JSON.stringify(n)),raicare.notification.notify({type:"success",message:"Compare: "+JSON.stringify(n)})):raicare.notification.notify({type:"error",message:"Не выбраны отчеты"})};s.addEventListener("click",l),t.container.addEventListener("change",o),e.addEventListener("click",r),t.on("datatable.page",i),t.on("datatable.perpage",i),t.on("datatable.sort",i),t.wrapper.getElementsByClassName("dataTable-top")[0].classList.add("hide"),t.columns().sort(2,"asc"),t.columns().hide([5])}(),n&&e.initProgressTable(),e}({})},47:function(e,t,n){e.exports=function(e){return e.get=n(32),e.send=n(35),e.new=n(34),e.load=n(33),e.table=n(36),e}({})}});