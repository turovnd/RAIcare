var survey=function(e){function t(s){if(n[s])return n[s].exports;var a=n[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=39)}({27:function(e,t){e.exports=function(e){function t(){var t=window.location.hash.replace("#",""),n=null;""===t&&(t="progress"),n="progress"===t?"":t,n=document.querySelector('.aside__link[href="#'+n+'"]'),e.unit(n,t)}function n(e){return-1!==m.indexOf(e)||(raisoft.notification.notify({type:"error",message:"Не правильно указан адрес"}),!1)}function s(e){var t=new FormData;t.append("unit",e),t.append("survey",f),t.append("pension",u),t.append("csrf",document.getElementById("csrf").value);var n={url:"/survey/getunit",type:"POST",data:t,beforeSend:function(){document.getElementsByClassName("wrapper")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,l),document.getElementsByClassName("wrapper")[0].classList.remove("loading"),165===parseInt(e.code)?(c.innerHTML=e.html,i()):raisoft.notification.notify({type:e.status,message:e.message})},error:function(e){raisoft.core.log("ajax error occur on getting unit of survey","error",l,e),document.getElementsByClassName("wrapper")[0].classList.remove("loading")}};raisoft.ajax.send(n)}function a(){var e=new FormData,t=parseInt(v.dataset.offset);e.append("type",y),e.append("patients",E),e.append("offset",t),e.append("patient",d),e.append("pension",u),e.append("csrf",document.getElementById("csrf").value);var n={url:"/survey/get",type:"POST",data:e,beforeSend:function(){p=!0,v.getElementsByClassName("fa")[0].classList.remove("fa-plus"),v.getElementsByClassName("fa")[0].classList.add("fa-spinner","fa-fw","fa-pulse")},success:function(e){if(e=JSON.parse(e),raisoft.core.log(e.message,e.status,l),p=!1,v.getElementsByClassName("fa")[0].classList.add("fa-plus"),v.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse"),162===parseInt(e.code))if(0!==e.forms.length){for(var n=null,s=null,a=null,o=0;o<e.forms.length;o++){n=document.querySelectorAll("[data-datetime]"),n=new Date(n[n.length-1].dataset.datetime),a=new Date(e.forms[o].date),a-n!=0&&(s=raisoft.draw.node("LI","time-line__separator",{"data-datetime":e.forms[o].date}),g.insertBefore(s,g.getElementsByClassName("time-line__end")[0]));var r=raisoft.draw.node("LI","time-line__item"+((t+o)%2==0?"":" time-line__item--inverted"));r.innerHTML=e.forms[o].html,g.insertBefore(r,g.getElementsByClassName("time-line__end")[0])}v.dataset.offset=parseInt(t)+parseInt(e.number)}else v.parentNode.remove();else raisoft.notification.notify({type:e.status,message:e.message})},error:function(e){raisoft.core.log("ajax error occur on getting patients","error",l,e),p=!1,v.getElementsByClassName("fa")[0].classList.add("fa-plus"),v.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse")}};raisoft.ajax.send(n)}function o(){var e=B.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===p&&r()}function r(){var e=new FormData,t=I.dataset.offset,n=h;e.append("name",n),e.append("offset",t),e.append("csrf",document.getElementById("csrf").value);var s={url:"/survey/search",type:"POST",data:e,beforeSend:function(){p=!0,I.innerHTML="Загрузка ..."},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,l),p=!1,162===parseInt(e.code)?(I.innerHTML="Загрузить ещё",""!==e.html?(I.dataset.offset=parseInt(t)+parseInt(e.number),h===n?B.innerHTML+=e.html:B.innerHTML=e.html):(I.innerHTML="Всего "+parseInt(parseInt(t)+parseInt(e.number)),document.removeEventListener("scroll",o))):(I.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",document.removeEventListener("scroll",o),raisoft.notification.notify({type:e.status,message:e.message}))},error:function(e){raisoft.core.log("ajax error occur on searching surveys","error",l,e),I.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",document.removeEventListener("scroll",o),p=!1}};raisoft.ajax.send(s)}function i(){if(document.getElementsByClassName("js-single-select").length>0&&new raisoft.choices(".js-single-select",{shouldSort:!1,searchEnabled:!1,itemSelectText:"выбрать"}),document.getElementsByClassName("js-single-select--with-search").length>0&&new raisoft.choices(".js-single-select--with-search",{searchEnabled:!0,loadingText:"Загрузка...",noResultsText:"Ничего не найдено",noChoicesText:"Нет элементов для выбора",itemSelectText:"выбрать"}),document.getElementsByClassName("js-multiple-select").length>0&&new raisoft.choices(".js-multiple-select",{removeItemButton:!0,placeholderValue:"Введите для поиска",noResultsText:"Ничего не найдено",noChoicesText:"Нет элементов для выбора",itemSelectText:"выбрать"}),document.getElementById("I2")){var e=new raisoft.choices(document.getElementById("I2"),{removeItemButton:!0,placeholderValue:"Введите названия диагноза или код МКБ-10",loadingText:"Загрузка...",noResultsText:"Ничего не найдено",noChoicesText:"Нет элементов для выбора",itemSelectText:"выбрать",searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:10,searchFields:["label","value"]});e.passedElement.addEventListener("search",function(t){e.ajax(function(e){fetch("/mkb10/get?name="+t.detail.value).then(function(t){t.json().then(function(t){e(t,"value","label")})}).catch(function(e){console.log(e)})})},!1)}}var l="Survey: get AJAX",c=document.getElementsByClassName("section__content")[0],u=document.getElementById("pensionID"),d=document.getElementById("patientID"),m=["progress","unitA","unitB","unitC","unitD","unitE","unitF","unitG","unitH","unitI","unitJ","unitK","unitL","unitM","unitN","unitO","unitP","unitQ","unitR"],f=document.getElementById("surveyID"),p=!1;u&&(u=u.value),d&&(d=d.value),f&&(f=f.value),e.unitstart=function(){var e=document.getElementById("unavailableUnits");if(e){e=JSON.parse(e.value);for(var n=0;n<e.length;n++){m.splice(m.indexOf(e[n]),1);var s=document.querySelector(".aside__link[href='#"+e[n]+"']");s&&s.parentNode.remove()}window.addEventListener("hashchange",t),t()}},e.unit=function(e,t){n(t)&&(document.getElementsByClassName("aside__item--active")[0]&&document.getElementsByClassName("aside__item--active")[0].classList.remove("aside__item--active"),document.getElementsByClassName("aside__link--active")[0]&&document.getElementsByClassName("aside__link--active")[0].classList.remove("aside__link--active"),e.parentNode.classList.add("aside__item--active"),e.classList.add("aside__link--active"),s(t))};var g=null,v=null,y=null,E=null;e.forms=function(){g&&v||(v=document.getElementById("getMoreFormsBtn"),g=document.getElementById("timeline"),E=g.dataset.pk,y=v.dataset.type),p||a()};var B=document.getElementById("surveys"),h="",I=document.getElementById("getMoreBtn");return e.search=function(e){h=e.value,p||(I.dataset.offset=0,B.innerHTML="",r())},e.surveys=function(e){I=e,p||(r(),document.addEventListener("scroll",o))},e}({})},28:function(e,t){e.exports=function(e){var t="Survey: send AJAX",n=document.getElementById("surveyID"),s=document.getElementById("pensionID");return n&&(n=n.value),s&&(s=s.value),e.updateunit=function(e){var a=document.getElementById(e);if(a){var o=new FormData(a);o.append("unit",e),o.append("survey",n),o.append("pension",s),o.append("csrf",document.getElementById("csrf").value);var r={url:"/survey/updateunit",type:"POST",data:o,beforeSend:function(){a.getElementsByClassName("form")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,t),a.getElementsByClassName("form")[0].classList.remove("loading"),raisoft.notification.notify({type:e.status,message:e.message}),169===parseInt(e.code)&&window.location.reload()},error:function(e){raisoft.core.log("ajax error occur on updating unit data","error",t,e),a.getElementsByClassName("form")[0].classList.remove("loading")}};raisoft.ajax.send(r)}},e.newpatientform=function(){var e=document.getElementById("newPatientModalForm"),n=new FormData(e);n.append("pension",s),n.append("csrf",document.getElementById("csrf").value);var a={url:"/patient/new",type:"POST",data:n,beforeSend:function(){e.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(n){n=JSON.parse(n),raisoft.core.log(n.message,n.status,t),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),raisoft.notification.notify({type:n.status,message:n.message}),151===parseInt(n.code)&&(raisoft.modal.hide(e),window.location.assign("survey/"+n.id))},error:function(n){raisoft.core.log("ajax error occur on sending new patient form","error",t,n),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raisoft.ajax.send(a)},e.newpatientformwithtype=function(e){var n=new FormData,a=e.dataset.pk,o=e.dataset.area,r=document.getElementById(o).getElementsByClassName("js-form-type")[0].value,i=e.parentNode;if(""===r)return void raisoft.notification.notify({type:"error",message:"Пожалуйста выберите причина прохождения оценки пациентом"});n.append("pension",s),n.append("patient",a),n.append("type",r),n.append("csrf",document.getElementById("csrf").value);var l={url:"/survey/new",type:"POST",data:n,beforeSend:function(){i.classList.add("loading")},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,t),i.classList.remove("loading"),raisoft.notification.notify({type:e.status,message:e.message}),161===parseInt(e.code)&&window.location.assign("survey/"+e.id)},error:function(e){raisoft.core.log("ajax error occur on sending new patient form","error",t,e),i.classList.remove("loading")}};raisoft.ajax.send(l)},e}({})},39:function(e,t,n){e.exports=function(e){return e.get=n(27),e.send=n(28),e}({})}});