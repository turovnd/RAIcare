var survey=function(e){function t(a){if(n[a])return n[a].exports;var s=n[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=35)}({24:function(e,t){e.exports=function(e){function t(){var e=r.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===c&&n()}function n(){var e=new FormData,n=m.dataset.offset,a=f;e.append("name",a),e.append("pension",l),e.append("offset",n),e.append("csrf",document.getElementById("csrf").value);var r={url:"/patient/"+i,type:"POST",data:e,beforeSend:function(){c=!0,m.innerHTML="Загрузка ..."},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,s),c=!1,150===parseInt(e.code)?(m.innerHTML="Загрузить ещё",""!==e.html?(m.dataset.offset=parseInt(n)+parseInt(e.number),f===a?d.innerHTML+=e.html:d.innerHTML=e.html):(m.innerHTML="Всего "+parseInt(parseInt(n)+parseInt(e.number)),document.removeEventListener("scroll",t))):(m.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",raisoft.notification.notify({type:e.status,message:e.message}))},error:function(e){raisoft.core.log("ajax error occur on getting patients","error",s,e),m.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",c=!1}};raisoft.ajax.send(r)}function a(){var e=new FormData,t=parseInt(p.dataset.offset);e.append("type",g),e.append("patients",y),e.append("offset",t),e.append("csrf",document.getElementById("csrf").value);var n={url:"/forms/longterm/get",type:"POST",data:e,beforeSend:function(){v=!0,p.getElementsByClassName("fa")[0].classList.remove("fa-plus"),p.getElementsByClassName("fa")[0].classList.add("fa-spinner","fa-fw","fa-pulse")},success:function(e){if(e=JSON.parse(e),raisoft.core.log(e.message,e.status,s),v=!1,p.getElementsByClassName("fa")[0].classList.add("fa-plus"),p.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse"),162===parseInt(e.code))if(0!==e.forms.length){for(var n=null,a=null,r=null,o=0;o<e.forms.length;o++){n=document.querySelectorAll("[data-datetime]"),n=new Date(n[n.length-1].dataset.datetime),r=new Date(e.forms[o].date),r-n!=0&&(a=raisoft.draw.node("LI","time-line__separator",{"data-datetime":e.forms[o].date}),u.insertBefore(a,u.getElementsByClassName("time-line__end")[0]));var i=raisoft.draw.node("LI","time-line__item"+((t+o)%2==0?"":" time-line__item--inverted"));i.innerHTML=e.forms[o].html,u.insertBefore(i,u.getElementsByClassName("time-line__end")[0])}p.dataset.offset=parseInt(t)+parseInt(e.number)}else p.parentNode.remove();else raisoft.notification.notify({type:e.status,message:e.message})},error:function(e){raisoft.core.log("ajax error occur on getting patients","error",s,e),v=!1,p.getElementsByClassName("fa")[0].classList.add("fa-plus"),p.getElementsByClassName("fa")[0].classList.remove("fa-spinner","fa-fw","fa-pulse")}};raisoft.ajax.send(n)}var s="Survey: get AJAX",r=document.getElementsByClassName("section__content")[0],o=null,i=null,l=document.getElementById("pensionID");l&&(l=l.value),e.unit=function(e){o||(o=document.getElementById("formID").value),window.location.assign("survey?id="+o+"&unit="+e)};var f="",d=document.getElementById("patients"),m=document.getElementById("getMorePatientsBtn"),c=!1;e.search=function(e,t){i||(i=t),f=e.value,c||(m.dataset.offset=0,d.innerHTML="",n())},e.patients=function(e,a){i||(i=a),m=e,c||(n(),document.addEventListener("scroll",t))};var u=null,p=null,g=null,y=null,v=!1;return e.forms=function(){u&&p||(p=document.getElementById("getMoreFormsBtn"),u=document.getElementById("timeline"),y=u.dataset.pk,g=p.dataset.type),v||a()},e}({})},25:function(e,t){e.exports=function(e){var t="Survey: send AJAX",n=(document.getElementsByClassName("section__content")[0],document.getElementById("pensionID"));return n&&(n=n.value),e.unit=function(e){},e.newpatientform=function(){var e=document.getElementById("newPatientModalForm"),a=new FormData(e);a.append("pension",n),a.append("csrf",document.getElementById("csrf").value);var s={url:"/patient/new",type:"POST",data:a,beforeSend:function(){e.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(n){n=JSON.parse(n),raisoft.core.log(n.message,n.status,t),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),raisoft.notification.notify({type:n.status,message:n.message}),151===parseInt(n.code)&&(raisoft.modal.hide(e),window.location.assign("survey?id="+n.id))},error:function(n){raisoft.core.log("ajax error occur on sending new patient form","error",t,n),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raisoft.ajax.send(s)},e.newpatientformwithtype=function(e){var a=new FormData,s=e.dataset.pk,r=e.dataset.area,o=document.getElementById(r).getElementsByClassName("js-form-type")[0].value,i=e.parentNode;if(""===o)return void raisoft.notification.notify({type:"error",message:"Пожалуйста выберите причина прохождения оценки пациентом"});a.append("pension",n),a.append("patient",s),a.append("type",o),a.append("csrf",document.getElementById("csrf").value);var l={url:"/forms/longterm/create",type:"POST",data:a,beforeSend:function(){i.classList.add("loading")},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,t),i.classList.remove("loading"),raisoft.notification.notify({type:e.status,message:e.message}),161===parseInt(e.code)&&window.location.assign("survey?id="+e.id)},error:function(e){raisoft.core.log("ajax error occur on sending new patient form","error",t,e),i.classList.remove("loading")}};raisoft.ajax.send(l)},e}({})},35:function(e,t,n){e.exports=function(e){return e.get=n(24),e.send=n(25),e}({})}});