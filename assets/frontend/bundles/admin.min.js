var admin=function(e){function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=28)}({2:function(e,n){e.exports=function(e){return e.changerole=function(e){"new"===e.value?(document.getElementById("newUserPermissions").classList.remove("hide"),document.getElementById("newUserRoleName").parentNode.classList.remove("hide")):(document.getElementById("newUserPermissions").classList.add("hide"),document.getElementById("newUserRoleName").parentNode.classList.add("hide"))},e.create=function(){for(var e=document.getElementById("newUserForm"),n=new FormData,t=document.getElementById("newUserPermissions").querySelectorAll(".checkbox:checked"),s=[],o=0;o<t.length;o++)s.push(t[o].id.split("_")[1]);n.append("csrf",document.getElementById("csrf").value),n.append("name",document.getElementById("newUser").value),n.append("email",document.getElementById("newUserEmail").value),n.append("role",document.getElementById("newUserRole").value),n.append("roleName",document.getElementById("newUserRoleName").value),n.append("permissions",JSON.stringify(s));var i={url:"/profile/new",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){n=JSON.parse(n),raisoft.core.log(n.message,n.status,"RAIsoft admin"),e.classList.remove("loading"),raisoft.notification.notify({type:n.status,message:n.message}),50===parseInt(n.code)&&window.location.assign("/profile/"+n.id)},error:function(n){raisoft.core.log("ajax error occur on crating new user","error","RAIsoft admin",n),e.classList.remove("loading")}};raisoft.ajax.send(i)},e}({})},28:function(e,n,t){e.exports=function(e){return e.permissions=t(3),e.newuser=t(2),e}({})},3:function(e,n){e.exports=function(e){function n(){m=document.getElementById("permissions"),document.getElementById("js-add-permission").addEventListener("click",i);var e=document.getElementsByClassName("js-edit-permission");for(d=0;d<e.length;d++)e[d].addEventListener("click",a);var n=document.getElementsByClassName("js-delete-permission");for(d=0;d<n.length;d++)n[d].addEventListener("click",r)}function t(){var e=document.getElementById("newPermissionForm"),n=new FormData,t=document.getElementById("newPermissionFormId").value,s=document.getElementById("newPermissionFormName").value;n.append("id",t),n.append("name",s),n.append("csrf",document.getElementById("csrf").value);var o={url:"/admin/permission/add",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raisoft.core.log(n.message,n.status,l),e.classList.remove("loading"),raisoft.notification.notify({type:n.status,message:n.message}),111===parseInt(n.code)){var o=raisoft.draw.node("LI","p-b-10");o.innerHTML='<div class="fl_r"><button role="button" class="fl_l m-l-5 js-edit-permission" data-id="'+t+'" data-name="'+s+'"><i class="fa fa-edit text-brand" aria-hidden="true"></i></button><button role="button" class="fl_l m-l-5 js-delete-permission" data-id="'+t+'"><i class="fa fa-trash text-danger" aria-hidden="true"></i></button></div><span class="permission-id">id:'+t+' - name: </span><span class="permission-name" data-id="'+t+'" >'+s+"</span>",m.appendChild(o),o.getElementsByClassName("js-edit-permission")[0].addEventListener("click",a),o.getElementsByClassName("js-delete-permission")[0].addEventListener("click",r),c.close(),c=null}},error:function(n){raisoft.core.log("ajax error occur on crating new permission","error",l,n),e.classList.remove("loading")}};raisoft.ajax.send(o)}function s(){var e=document.getElementById("editPermissionForm"),n=new FormData,t=document.getElementById("editPermissionFormName").value,s=document.getElementById("editPermissionFormName").dataset.id;n.append("name",t),n.append("id",s),n.append("csrf",document.getElementById("csrf").value);var o={url:"/admin/permission/update",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raisoft.core.log(n.message,n.status,l),e.classList.remove("loading"),raisoft.notification.notify({type:n.status,message:n.message}),113===parseInt(n.code)){var o=document.querySelector('.permission-name[data-id="'+s+'"]'),i=document.querySelectorAll('[data-permission="'+s+'"]');for(d=0;d<i.length;d++)i[d].textContent=t;o.textContent=t,o.parentNode.getElementsByClassName("js-edit-permission")[0].dataset.name=t,u.close(),u=null}},error:function(n){raisoft.core.log("ajax error occur on updating permission form","error",l,n),e.classList.remove("loading")}};raisoft.ajax.send(o)}function o(){var e=document.getElementById("deletePermissionForm"),n=new FormData,t=e.dataset.id;n.append("id",t),n.append("csrf",document.getElementById("csrf").value);var s={url:"/admin/permission/delete",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raisoft.core.log(n.message,n.status,l),e.classList.remove("loading"),raisoft.notification.notify({type:n.status,message:n.message}),114===parseInt(n.code)){var s=document.querySelector('.permission-name[data-id="'+t+'"]').parentNode,o=document.querySelectorAll('[data-permission="'+t+'"]');for(d=0;d<o.length;d++)1===o[d].parentNode.childElementCount?o[d].parentNode.parentNode.remove():o[d].remove();s.getElementsByClassName("js-edit-permission")[0].removeEventListener("click",a),s.getElementsByClassName("js-delete-permission")[0].removeEventListener("click",r),s.remove(),f.close(),f=null}},error:function(n){raisoft.core.log("ajax error occur on deleting permission form","error",l,n),e.classList.remove("loading")}};raisoft.ajax.send(s)}function i(){null===c&&(c=raisoft.notification.notify({type:"confirm",message:'<div id="newPermissionForm"><h2>Новое право доступа</h2><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormId" class="form-group__control" type="number" placeholder="id права доступа" min="1"></div><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormName" class="form-group__control" type="text" placeholder="Наименование права доступа"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Создать",confirm:t,cancel:function(){c=null}}))}function a(){if(null===u){var e=this.dataset.id,n=this.dataset.name;u=raisoft.notification.notify({type:"confirm",message:'<div id="editPermissionForm"><h2>Редактировать право доступа</h2><div class="form-group"><input id="editPermissionFormName" type="text" class="form-group__control" data-id="'+e+'" value="'+n+'"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Изменить",confirm:s,cancel:function(){u=null}})}}function r(){if(null===f){var e=this.dataset.id;f=raisoft.notification.notify({type:"confirm",message:'<div id="deletePermissionForm" data-id="'+e+'"><h2>Удалить право доступа</h2><p>Удалив право доступа, Вы не сможете его восстановить</p></div>',showCancelButton:!0,validation:!0,confirmText:"Удалить",confirm:o,cancel:function(){f=null}})}}var d,l="RAIsoft admin",m=null,c=null,u=null,f=null;return e.init=function(){n()},e}({})}});