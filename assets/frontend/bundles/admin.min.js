var admin=function(e){function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=37)}({37:function(e,n,t){e.exports=function(e){return e.permissions=t(5),e.roles=t(6),e.newuser=t(4),e}({})},4:function(e,n){e.exports=function(e){return e.changerole=function(e){"new"===e.value?(document.getElementById("newUserPermissions").classList.remove("hide"),document.getElementById("newUserRoleName").parentNode.classList.remove("hide")):(document.getElementById("newUserPermissions").classList.add("hide"),document.getElementById("newUserRoleName").parentNode.classList.add("hide"))},e.create=function(){for(var e=document.getElementById("newUserForm"),n=new FormData,t=document.getElementById("newUserPermissions").querySelectorAll(".checkbox:checked"),a=[],o=0;o<t.length;o++)a.push(t[o].id.split("_")[1]);n.append("csrf",document.getElementById("csrf").value),n.append("name",document.getElementById("newUser").value),n.append("email",document.getElementById("newUserEmail").value),n.append("role",document.getElementById("newUserRole").value),n.append("roleName",document.getElementById("newUserRoleName").value),n.append("permissions",JSON.stringify(a));var s={url:"/profile/new",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,"RAIcare admin"),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),50===parseInt(n.code)&&window.location.assign("/profile/"+n.id)},error:function(n){raicare.core.log("ajax error occur on crating new user","error","RAIcare admin",n),e.classList.remove("loading")}};raicare.ajax.send(s)},e}({})},5:function(e,n){e.exports=function(e){function n(){c=document.getElementById("permissions"),document.getElementById("js-add-permission").addEventListener("click",s);var e=document.getElementsByClassName("js-edit-permission");for(d=0;d<e.length;d++)e[d].addEventListener("click",r);var n=document.getElementsByClassName("js-delete-permission");for(d=0;d<n.length;d++)n[d].addEventListener("click",i)}function t(){var e=document.getElementById("newPermissionForm"),n=new FormData,t=document.getElementById("newPermissionFormId").value,a=document.getElementById("newPermissionFormName").value;n.append("id",t),n.append("name",a),n.append("csrf",document.getElementById("csrf").value);var o={url:"/admin/permission/add",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raicare.core.log(n.message,n.status,l),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),111===parseInt(n.code)){var o=raicare.draw.node("LI","p-b-10");o.innerHTML='<div class="fl_r"><button role="button" class="fl_l m-l-5 js-edit-permission" data-id="'+t+'" data-name="'+a+'"><i class="fa fa-edit text-brand" aria-hidden="true"></i></button><button role="button" class="fl_l m-l-5 js-delete-permission" data-id="'+t+'"><i class="fa fa-trash text-danger" aria-hidden="true"></i></button></div><span class="permission-id">id:'+t+' - name: </span><span class="permission-name" data-id="'+t+'" >'+a+"</span>",c.appendChild(o),o.getElementsByClassName("js-edit-permission")[0].addEventListener("click",r),o.getElementsByClassName("js-delete-permission")[0].addEventListener("click",i),m.close(),m=null}},error:function(n){raicare.core.log("ajax error occur on crating new permission","error",l,n),e.classList.remove("loading")}};raicare.ajax.send(o)}function a(){var e=document.getElementById("editPermissionForm"),n=new FormData,t=document.getElementById("editPermissionFormName").value,a=document.getElementById("editPermissionFormName").dataset.id;n.append("name",t),n.append("id",a),n.append("csrf",document.getElementById("csrf").value);var o={url:"/admin/permission/update",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raicare.core.log(n.message,n.status,l),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),113===parseInt(n.code)){var o=document.querySelector('.permission-name[data-id="'+a+'"]'),s=document.querySelectorAll('[data-permission="'+a+'"]');for(d=0;d<s.length;d++)s[d].textContent=t;o.textContent=t,o.parentNode.getElementsByClassName("js-edit-permission")[0].dataset.name=t,u.close(),u=null}},error:function(n){raicare.core.log("ajax error occur on updating permission form","error",l,n),e.classList.remove("loading")}};raicare.ajax.send(o)}function o(){var e=document.getElementById("deletePermissionForm"),n=new FormData,t=e.dataset.id;n.append("id",t),n.append("csrf",document.getElementById("csrf").value);var a={url:"/admin/permission/delete",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raicare.core.log(n.message,n.status,l),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),114===parseInt(n.code)){var a=document.querySelector('.permission-name[data-id="'+t+'"]').parentNode,o=document.querySelectorAll('[data-permission="'+t+'"]');for(d=0;d<o.length;d++)1===o[d].parentNode.childElementCount?o[d].parentNode.parentNode.remove():o[d].remove();a.getElementsByClassName("js-edit-permission")[0].removeEventListener("click",r),a.getElementsByClassName("js-delete-permission")[0].removeEventListener("click",i),a.remove(),p.close(),p=null}},error:function(n){raicare.core.log("ajax error occur on deleting permission form","error",l,n),e.classList.remove("loading")}};raicare.ajax.send(a)}function s(){null===m&&(m=raicare.notification.notify({type:"confirm",message:'<div id="newPermissionForm"><h2>Новое право доступа</h2><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormId" class="form-group__control" type="number" placeholder="id права доступа" min="1"></div><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormName" class="form-group__control" type="text" placeholder="Наименование права доступа"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Создать",confirm:t,cancel:function(){m=null}}))}function r(){if(null===u){var e=this.dataset.id,n=this.dataset.name;u=raicare.notification.notify({type:"confirm",message:'<div id="editPermissionForm"><h2>Редактировать право доступа</h2><div class="form-group"><input id="editPermissionFormName" type="text" class="form-group__control" data-id="'+e+'" value="'+n+'"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Изменить",confirm:a,cancel:function(){u=null}})}}function i(){if(null===p){var e=this.dataset.id;p=raicare.notification.notify({type:"confirm",message:'<div id="deletePermissionForm" data-id="'+e+'"><h2>Удалить право доступа</h2><p>Удалив право доступа, Вы не сможете его восстановить</p></div>',showCancelButton:!0,validation:!0,confirmText:"Удалить",confirm:o,cancel:function(){p=null}})}}var d,l="RAIcare admin",c=null,m=null,u=null,p=null;return e.init=function(){n()},e}({})},6:function(e,n){e.exports=function(e){function n(e){var n=document.getElementsByClassName("permission-name"),t="",o=[];for(a=0;a<n.length;a++)o[n[a].dataset.id]={id:n[a].dataset.id,name:n[a].textContent,checked:""};for(a=0;a<e.length;a++)o[e[a].id].checked="checked";for(;o.length>1;){var s=o.pop();t='<p><input type="checkbox" id="modalpermission_'+s.id+'" class="checkbox" '+s.checked+' value="'+s.name+'"><label for="modalpermission_'+s.id+'" class="checkbox-label">'+s.name+"</label></p>"+t}return t}function t(e){var n=document.getElementById("updateRoleName").value,t="";for(t='<span class="role-name">'+n+'</span><button onclick="admin.roles.openmodal(this)" role="button" class="m-l-5" data-pk="'+o+'" data-rolename="'+n+"\" data-permissions='"+JSON.stringify(e)+'\'><i class="fa fa-edit text-brand" aria-hidden="true"></i></button><ul>',a=0;a<e.length;a++)t+='<li data-permission="'+e[a].id+'">'+e[a].name+"</li>";return t+="</ul>"}var a,o=null,s=null;return e.openmodal=function(e){o=e.dataset.pk,s=e.parentNode;var t=e.dataset.rolename,a=JSON.parse(e.dataset.permissions);raicare.modal.create({id:"updateRoleModal",header:"Изменить права доступа роли: "+t,body:'<fieldset><div class="form-group"><label for="updateRoleName" class="form-group__label">Название роли</label><input type="text" id="updateRoleName" class="form-group__control" maxlength="128" value="'+t+'"></div></fieldset><fieldset id="updatePermissions" class="m-b-0"><div class="form-group">'+n(a)+"</div></fieldset>",footer:'<button type="button" class="btn btn--default" data-close="modal">Отмена</button><button onclick="admin.roles.updaterole()" type="button" class="btn btn--brand">Изменить</button>'})},e.updaterole=function(){var e=document.getElementById("updateRoleModal"),n=new FormData,r=document.getElementById("updatePermissions").querySelectorAll(".checkbox:checked"),i=[],d=[];for(a=0;a<r.length;a++)i.push(r[a].id.split("_")[1]),d.push({id:r[a].id.split("_")[1],name:r[a].value});n.append("role",o),n.append("name",document.getElementById("updateRoleName").value),n.append("permissions",JSON.stringify(i)),n.append("csrf",document.getElementById("csrf").value);var l={url:"/admin/role/update",type:"POST",data:n,beforeSend:function(){e.getElementsByClassName("modal__content")[0].classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,"RAIcare admin"),e.getElementsByClassName("modal__content")[0].classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),103===parseInt(n.code)&&(s.innerHTML=t(d),raicare.modal.hide(e),e.remove())},error:function(n){raicare.core.log("ajax error occur on changing user role","error","RAIcare admin",n),e.getElementsByClassName("modal__content")[0].classList.remove("loading")}};raicare.ajax.send(l)},e}({})}});