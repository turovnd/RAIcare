var admin=function(e){function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=211)}({172:function(e,n){e.exports=function(e){return e.changerole=function(e){"new"===e.value?(document.getElementById("newUserPermissions").classList.remove("hide"),document.getElementById("newUserRoleName").parentNode.classList.remove("hide")):(document.getElementById("newUserPermissions").classList.add("hide"),document.getElementById("newUserRoleName").parentNode.classList.add("hide"))},e.create=function(){for(var e=document.getElementById("newUserForm"),n=new FormData,t=document.getElementById("newUserPermissions").querySelectorAll(".checkbox:checked"),a=[],r=0;r<t.length;r++)a.push(t[r].id.split("_")[1]);n.append("csrf",document.getElementById("csrf").value),n.append("name",document.getElementById("newUser").value),n.append("email",document.getElementById("newUserEmail").value),n.append("role",document.getElementById("newUserRole").value),n.append("roleName",document.getElementById("newUserRoleName").value),n.append("permissions",JSON.stringify(a));var o={url:"/profile/new",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){n=JSON.parse(n),raicare.core.log(n.message,n.status,"RAIcare admin"),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),50===parseInt(n.code)&&window.location.assign("/profile/"+n.id)},error:function(n){raicare.core.log("ajax error occur on crating new user","error","RAIcare admin",n),e.classList.remove("loading")}};raicare.ajax.send(o)},e}({})},173:function(e,n){e.exports=function(e){function n(){c=document.getElementById("permissions"),document.getElementById("js-add-permission").addEventListener("click",o);var e=document.getElementsByClassName("js-edit-permission");for(d=0;d<e.length;d++)e[d].addEventListener("click",s);var n=document.getElementsByClassName("js-delete-permission");for(d=0;d<n.length;d++)n[d].addEventListener("click",i)}function t(){var e=document.getElementById("newPermissionForm"),n=new FormData,t=document.getElementById("newPermissionFormId").value,a=document.getElementById("newPermissionFormName").value;n.append("id",t),n.append("name",a),n.append("csrf",document.getElementById("csrf").value);var r={url:"/admin/permission/add",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raicare.core.log(n.message,n.status,l),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),111===parseInt(n.code)){var r=raicare.draw.node("LI","p-b-10");r.innerHTML='<div class="fl_r"><button role="button" class="fl_l m-l-5 js-edit-permission" data-id="'+t+'" data-name="'+a+'"><i class="fa fa-edit text-brand" aria-hidden="true"></i></button><button role="button" class="fl_l m-l-5 js-delete-permission" data-id="'+t+'"><i class="fa fa-trash text-danger" aria-hidden="true"></i></button></div><span class="permission-id">id:'+t+' - name: </span><span class="permission-name" data-id="'+t+'" >'+a+"</span>",c.appendChild(r),r.getElementsByClassName("js-edit-permission")[0].addEventListener("click",s),r.getElementsByClassName("js-delete-permission")[0].addEventListener("click",i),m.close(),m=null}},error:function(n){raicare.core.log("ajax error occur on crating new permission","error",l,n),e.classList.remove("loading")}};raicare.ajax.send(r)}function a(){var e=document.getElementById("editPermissionForm"),n=new FormData,t=document.getElementById("editPermissionFormName").value,a=document.getElementById("editPermissionFormName").dataset.id;n.append("name",t),n.append("id",a),n.append("csrf",document.getElementById("csrf").value);var r={url:"/admin/permission/update",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raicare.core.log(n.message,n.status,l),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),113===parseInt(n.code)){var r=document.querySelector('.permission-name[data-id="'+a+'"]'),o=document.querySelectorAll('[data-permission="'+a+'"]');for(d=0;d<o.length;d++)o[d].textContent=t;r.textContent=t,r.parentNode.getElementsByClassName("js-edit-permission")[0].dataset.name=t,u.close(),u=null}},error:function(n){raicare.core.log("ajax error occur on updating permission form","error",l,n),e.classList.remove("loading")}};raicare.ajax.send(r)}function r(){var e=document.getElementById("deletePermissionForm"),n=new FormData,t=e.dataset.id;n.append("id",t),n.append("csrf",document.getElementById("csrf").value);var a={url:"/admin/permission/delete",type:"POST",data:n,beforeSend:function(){e.classList.add("loading")},success:function(n){if(n=JSON.parse(n),raicare.core.log(n.message,n.status,l),e.classList.remove("loading"),raicare.notification.notify({type:n.status,message:n.message}),114===parseInt(n.code)){var a=document.querySelector('.permission-name[data-id="'+t+'"]').parentNode,r=document.querySelectorAll('[data-permission="'+t+'"]');for(d=0;d<r.length;d++)1===r[d].parentNode.childElementCount?r[d].parentNode.parentNode.remove():r[d].remove();a.getElementsByClassName("js-edit-permission")[0].removeEventListener("click",s),a.getElementsByClassName("js-delete-permission")[0].removeEventListener("click",i),a.remove(),p.close(),p=null}},error:function(n){raicare.core.log("ajax error occur on deleting permission form","error",l,n),e.classList.remove("loading")}};raicare.ajax.send(a)}function o(){null===m&&(m=raicare.notification.notify({type:"confirm",message:'<div id="newPermissionForm"><h2>Новое право доступа</h2><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormId" class="form-group__control" type="number" placeholder="id права доступа" min="1"></div><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormName" class="form-group__control" type="text" placeholder="Наименование права доступа"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Создать",confirm:t,cancel:function(){m=null}}))}function s(){if(null===u){var e=this.dataset.id,n=this.dataset.name;u=raicare.notification.notify({type:"confirm",message:'<div id="editPermissionForm"><h2>Редактировать право доступа</h2><div class="form-group"><input id="editPermissionFormName" type="text" class="form-group__control" data-id="'+e+'" value="'+n+'"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Изменить",confirm:a,cancel:function(){u=null}})}}function i(){if(null===p){var e=this.dataset.id;p=raicare.notification.notify({type:"confirm",message:'<div id="deletePermissionForm" data-id="'+e+'"><h2>Удалить право доступа</h2><p>Удалив право доступа, Вы не сможете его восстановить</p></div>',showCancelButton:!0,validation:!0,confirmText:"Удалить",confirm:r,cancel:function(){p=null}})}}var d,l="RAIcare admin",c=null,m=null,u=null,p=null;return e.init=function(){n()},e}({})},174:function(e,n){e.exports=function(e){var n=null,t=null,a=null,r=function(e){e.preventDefault();var n={url:"/admin/newrole",type:"POST",data:new FormData(t),beforeSend:function(){t.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),t.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),100===parseInt(e.code)&&window.location.reload(),raicare.modal.hide(t),raicare.notification.notify({type:e.status,message:e.message})},error:function(e){raicare.core.log("ajax error occur on creating new role","error","Admin: roles",e),t.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raicare.ajax.send(n)},o=function(e){e.preventDefault();var t={url:"/admin/updaterole",type:"POST",data:new FormData(a),beforeSend:function(){a.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(e){e=JSON.parse(e),a.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),101===parseInt(e.code)&&(n.getElementsByTagName("td")[1].textContent=document.getElementById("updateRoleName").value),raicare.modal.hide(a),raicare.notification.notify({type:e.status,message:e.message})},error:function(e){raicare.core.log("ajax error occur on updating role","error","Admin: roles",e),a.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raicare.ajax.send(t)},s=function(e){var n=new FormData;n.append("id",e),n.append("csrf",document.getElementById("csrf").value);var t={url:"/admin/deleterole",type:"POST",data:n,beforeSend:function(){document.body.classList.add("loading")},success:function(e){e=JSON.parse(e),document.body.classList.remove("loading"),102===parseInt(e.code)&&window.location.reload(),raicare.notification.notify({type:e.status,message:e.message})},error:function(e){raicare.core.log("ajax error occur on deleting role","error","Admin: roles",e),document.body.classList.remove("loading")}};raicare.ajax.send(t)};return e.openmodal=function(e){n=e.parentNode.parentNode,document.getElementById("currentRoleID").value=n.getElementsByTagName("td")[0].textContent,document.getElementById("updateRoleName").value=n.getElementsByTagName("td")[1].textContent,raicare.modal.show(a)},e.delete=function(e){s(e)},e.init=function(){a=document.getElementById("updateRoleModal"),a.addEventListener("submit",o),t=document.getElementById("newRoleModal"),t.addEventListener("submit",r)},e}({})},211:function(e,n,t){e.exports=function(e){return e.permissions=t(173),e.roles=t(174),e.newuser=t(172),e}({})}});