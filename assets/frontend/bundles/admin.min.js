var admin=function(e){function t(o){if(n[o])return n[o].exports;var s=n[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=36)}({36:function(e,t,n){e.exports=function(e){return e.permissions=n(5),e.roles=n(6),e.newuser=n(4),e}({})},4:function(e,t){e.exports=function(e){return e.changerole=function(e){"new"===e.value?(document.getElementById("newUserPermissions").classList.remove("hide"),document.getElementById("newUserRoleName").parentNode.classList.remove("hide")):(document.getElementById("newUserPermissions").classList.add("hide"),document.getElementById("newUserRoleName").parentNode.classList.add("hide"))},e.create=function(){for(var e=document.getElementById("newUserForm"),t=new FormData,n=document.getElementById("newUserPermissions").querySelectorAll(".checkbox:checked"),o=[],s=0;s<n.length;s++)o.push(n[s].id.split("_")[1]);t.append("csrf",document.getElementById("csrf").value),t.append("name",document.getElementById("newUser").value),t.append("email",document.getElementById("newUserEmail").value),t.append("role",document.getElementById("newUserRole").value),t.append("roleName",document.getElementById("newUserRoleName").value),t.append("permissions",JSON.stringify(o));var a={url:"/profile/new",type:"POST",data:t,beforeSend:function(){e.classList.add("loading")},success:function(t){t=JSON.parse(t),raisoft.core.log(t.message,t.status,"RAIsoft admin"),e.classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),50===parseInt(t.code)&&window.location.assign("/profile/"+t.id)},error:function(t){raisoft.core.log("ajax error occur on crating new user","error","RAIsoft admin",t),e.classList.remove("loading")}};raisoft.ajax.send(a)},e}({})},5:function(e,t){e.exports=function(e){function t(){m=document.getElementById("permissions"),document.getElementById("js-add-permission").addEventListener("click",a);var e=document.getElementsByClassName("js-edit-permission");for(d=0;d<e.length;d++)e[d].addEventListener("click",i);var t=document.getElementsByClassName("js-delete-permission");for(d=0;d<t.length;d++)t[d].addEventListener("click",r)}function n(){var e=document.getElementById("newPermissionForm"),t=new FormData,n=document.getElementById("newPermissionFormId").value,o=document.getElementById("newPermissionFormName").value;t.append("id",n),t.append("name",o),t.append("csrf",document.getElementById("csrf").value);var s={url:"/admin/permission/add",type:"POST",data:t,beforeSend:function(){e.classList.add("loading")},success:function(t){if(t=JSON.parse(t),raisoft.core.log(t.message,t.status,l),e.classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),111===parseInt(t.code)){var s=raisoft.draw.node("LI","p-b-10");s.innerHTML='<div class="fl_r"><button role="button" class="fl_l m-l-5 js-edit-permission" data-id="'+n+'" data-name="'+o+'"><i class="fa fa-edit text-brand" aria-hidden="true"></i></button><button role="button" class="fl_l m-l-5 js-delete-permission" data-id="'+n+'"><i class="fa fa-trash text-danger" aria-hidden="true"></i></button></div><span class="permission-id">id:'+n+' - name: </span><span class="permission-name" data-id="'+n+'" >'+o+"</span>",m.appendChild(s),s.getElementsByClassName("js-edit-permission")[0].addEventListener("click",i),s.getElementsByClassName("js-delete-permission")[0].addEventListener("click",r),c.close(),c=null}},error:function(t){raisoft.core.log("ajax error occur on crating new permission","error",l,t),e.classList.remove("loading")}};raisoft.ajax.send(s)}function o(){var e=document.getElementById("editPermissionForm"),t=new FormData,n=document.getElementById("editPermissionFormName").value,o=document.getElementById("editPermissionFormName").dataset.id;t.append("name",n),t.append("id",o),t.append("csrf",document.getElementById("csrf").value);var s={url:"/admin/permission/update",type:"POST",data:t,beforeSend:function(){e.classList.add("loading")},success:function(t){if(t=JSON.parse(t),raisoft.core.log(t.message,t.status,l),e.classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),113===parseInt(t.code)){var s=document.querySelector('.permission-name[data-id="'+o+'"]'),a=document.querySelectorAll('[data-permission="'+o+'"]');for(d=0;d<a.length;d++)a[d].textContent=n;s.textContent=n,s.parentNode.getElementsByClassName("js-edit-permission")[0].dataset.name=n,u.close(),u=null}},error:function(t){raisoft.core.log("ajax error occur on updating permission form","error",l,t),e.classList.remove("loading")}};raisoft.ajax.send(s)}function s(){var e=document.getElementById("deletePermissionForm"),t=new FormData,n=e.dataset.id;t.append("id",n),t.append("csrf",document.getElementById("csrf").value);var o={url:"/admin/permission/delete",type:"POST",data:t,beforeSend:function(){e.classList.add("loading")},success:function(t){if(t=JSON.parse(t),raisoft.core.log(t.message,t.status,l),e.classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),114===parseInt(t.code)){var o=document.querySelector('.permission-name[data-id="'+n+'"]').parentNode,s=document.querySelectorAll('[data-permission="'+n+'"]');for(d=0;d<s.length;d++)1===s[d].parentNode.childElementCount?s[d].parentNode.parentNode.remove():s[d].remove();o.getElementsByClassName("js-edit-permission")[0].removeEventListener("click",i),o.getElementsByClassName("js-delete-permission")[0].removeEventListener("click",r),o.remove(),p.close(),p=null}},error:function(t){raisoft.core.log("ajax error occur on deleting permission form","error",l,t),e.classList.remove("loading")}};raisoft.ajax.send(o)}function a(){null===c&&(c=raisoft.notification.notify({type:"confirm",message:'<div id="newPermissionForm"><h2>Новое право доступа</h2><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormId" class="form-group__control" type="number" placeholder="id права доступа" min="1"></div><div class="form-group col-xs-12 col-sm-6"><input id="newPermissionFormName" class="form-group__control" type="text" placeholder="Наименование права доступа"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Создать",confirm:n,cancel:function(){c=null}}))}function i(){if(null===u){var e=this.dataset.id,t=this.dataset.name;u=raisoft.notification.notify({type:"confirm",message:'<div id="editPermissionForm"><h2>Редактировать право доступа</h2><div class="form-group"><input id="editPermissionFormName" type="text" class="form-group__control" data-id="'+e+'" value="'+t+'"></div></div>',showCancelButton:!0,validation:!0,confirmText:"Изменить",confirm:o,cancel:function(){u=null}})}}function r(){if(null===p){var e=this.dataset.id;p=raisoft.notification.notify({type:"confirm",message:'<div id="deletePermissionForm" data-id="'+e+'"><h2>Удалить право доступа</h2><p>Удалив право доступа, Вы не сможете его восстановить</p></div>',showCancelButton:!0,validation:!0,confirmText:"Удалить",confirm:s,cancel:function(){p=null}})}}var d,l="RAIsoft admin",m=null,c=null,u=null,p=null;return e.init=function(){t()},e}({})},6:function(e,t){e.exports=function(e){function t(e){var t=document.getElementsByClassName("permission-name"),n="",s=[];for(o=0;o<t.length;o++)s[t[o].dataset.id]={id:t[o].dataset.id,name:t[o].textContent,checked:""};for(o=0;o<e.length;o++)s[e[o].id].checked="checked";for(;s.length>1;){var a=s.pop();n='<p><input type="checkbox" id="modalpermission_'+a.id+'" class="checkbox" '+a.checked+' value="'+a.name+'"><label for="modalpermission_'+a.id+'" class="checkbox-label">'+a.name+"</label></p>"+n}return n}function n(e){var t=document.getElementById("updateRoleName").value,n="";for(n='<span class="role-name">'+t+'</span><button onclick="admin.roles.openmodal(this)" role="button" class="m-l-5" data-pk="'+s+'" data-rolename="'+t+"\" data-permissions='"+JSON.stringify(e)+'\'><i class="fa fa-edit text-brand" aria-hidden="true"></i></button><ul>',o=0;o<e.length;o++)n+='<li data-permission="'+e[o].id+'">'+e[o].name+"</li>";return n+="</ul>"}var o,s=null,a=null;return e.openmodal=function(e){s=e.dataset.pk,a=e.parentNode;var n=e.dataset.rolename,o=JSON.parse(e.dataset.permissions);raisoft.modal.create({id:"updateRoleModal",header:"Изменить права доступа роли: "+n,body:'<fieldset><div class="form-group"><label for="updateRoleName" class="form-group__label">Название роли</label><input type="text" id="updateRoleName" class="form-group__control" maxlength="128" value="'+n+'"></div></fieldset><fieldset id="updatePermissions" class="m-b-0"><div class="form-group">'+t(o)+"</div></fieldset>",footer:'<button type="button" class="btn btn--default" data-close="modal">Отмена</button><button onclick="admin.roles.updaterole()" type="button" class="btn btn--brand">Изменить</button>'})},e.updaterole=function(){var e=document.getElementById("updateRoleModal"),t=new FormData,i=document.getElementById("updatePermissions").querySelectorAll(".checkbox:checked"),r=[],d=[];for(o=0;o<i.length;o++)r.push(i[o].id.split("_")[1]),d.push({id:i[o].id.split("_")[1],name:i[o].value});t.append("role",s),t.append("name",document.getElementById("updateRoleName").value),t.append("permissions",JSON.stringify(r)),t.append("csrf",document.getElementById("csrf").value);var l={url:"/admin/role/update",type:"POST",data:t,beforeSend:function(){e.getElementsByClassName("modal__content")[0].classList.add("loading")},success:function(t){t=JSON.parse(t),raisoft.core.log(t.message,t.status,"RAIsoft admin"),e.getElementsByClassName("modal__content")[0].classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),103===parseInt(t.code)&&(a.innerHTML=n(d),raisoft.modal.hide(e),e.remove())},error:function(t){raisoft.core.log("ajax error occur on changing user role","error","RAIsoft admin",t),e.getElementsByClassName("modal__content")[0].classList.remove("loading")}};raisoft.ajax.send(l)},e}({})}});