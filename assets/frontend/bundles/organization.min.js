var organization=function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=27)}({17:function(e,t){e.exports=function(e){function t(){var e=document.getElementById("excludeForm"),t=new FormData;t.append("user",a),t.append("organization",document.getElementById("organizationID").value),t.append("csrf",document.getElementById("csrf").value);var o={url:"/profile/excludeuser",type:"POST",data:t,beforeSend:function(){e.classList.add("loading")},success:function(t){t=JSON.parse(t),raisoft.core.log(t.message,t.status,n),e.classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),133===parseInt(t.code)&&(r.remove(),s.close(),s=null)},error:function(t){raisoft.core.log("ajax error occur on inviting coworker","error",n,t),e.classList.remove("loading")}};raisoft.ajax.send(o)}function o(){for(var e=JSON.parse(document.getElementById("availableRoles").value),t="",o=0;o<e.length;o++)t+='<option value="'+e[o].id+'">'+e[o].name+"</option>";return t}var n="Organiz: coworker",a=null,r=null,s=null,i=null;return e.invite=function(){var e=document.getElementById("inviteCoWorkerModal"),t=new FormData(e);t.append("organization",document.getElementById("organizationID").value),t.append("csrf",document.getElementById("csrf").value);var o={url:"/profile/inviteuser",type:"POST",data:t,beforeSend:function(){e.getElementsByClassName("modal__content")[0].classList.add("loading")},success:function(t){t=JSON.parse(t),raisoft.core.log(t.message,t.status,n),e.getElementsByClassName("modal__content")[0].classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),62===parseInt(t.code)&&raisoft.modal.hide(e)},error:function(t){raisoft.core.log("ajax error occur on inviting coworker","error",n,t),e.getElementsByClassName("modal__content")[0].classList.remove("loading")}};raisoft.ajax.send(o)},e.exclude=function(e){a=e.dataset.pk,r=e.parentNode;var o=e.dataset.name;s=raisoft.notification.notify({type:"confirm",message:'<div id="excludeForm"><h2>Исключить сотрудника</h2><p>Вы уверены, то хотите исключить '+o+"?</p><p>Исключив сотрудника, у него больше не будет доступа к системе.</p></div>",confirmText:"Исключить",showCancelButton:!0,validation:!0,confirm:t,cancel:function(){a=null}})},e.openupdaterole=function(e){i=e.parentNode.getElementsByClassName("label")[0],raisoft.modal.create({id:"updateCoWorkerModal",header:"Изменить роль сотрудника",body:'<div class="form-group"><label for="updateCoWorkerRole" class="form-group__label">Роль</label><select name="role" id="updateCoWorkerRole" data-pk="'+e.dataset.pk+'" class="form-group__control">'+o()+"</select></div>",footer:'<button type="button" class="btn btn--default" data-close="modal">Отмена</button><button onclick="organization.coworker.updaterole()" type="button" class="btn btn--brand">Изменить</button>'})},e.updaterole=function(){var e=document.getElementById("updateCoWorkerModal"),t=new FormData(e);t.append("organization",document.getElementById("organizationID").value),t.append("role",document.getElementById("updateCoWorkerRole").value),t.append("user",document.getElementById("updateCoWorkerRole").dataset.pk),t.append("csrf",document.getElementById("csrf").value);var o={url:"/profile/changerole",type:"POST",data:t,beforeSend:function(){e.getElementsByClassName("modal__content")[0].classList.add("loading")},success:function(t){t=JSON.parse(t),raisoft.core.log(t.message,t.status,n),e.getElementsByClassName("modal__content")[0].classList.remove("loading"),raisoft.notification.notify({type:t.status,message:t.message}),53===parseInt(t.code)&&(raisoft.modal.hide(e),i.textContent=t.role.name,i=null,e.remove())},error:function(t){raisoft.core.log("ajax error occur on changing coworker role","error",n,t),e.getElementsByClassName("modal__content")[0].classList.remove("loading")}};raisoft.ajax.send(o)},e}({})},18:function(e,t){e.exports=function(e){return e.toggle=function(e){var t=e.closest(".js-field-name");t.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),t.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide")},e.save=function(e){var t=document.getElementById("organization"),o=e.closest(".js-field-name"),n=o.getElementsByClassName("form-group__control")[0].value,a=o.getElementsByClassName("form-group__control")[0].name,r=new FormData;r.append("id",document.getElementById("organizationID").value),r.append("csrf",document.getElementById("csrf").value),r.append("name",a),r.append("value",n);var s={url:"/organization/update",type:"POST",data:r,beforeSend:function(){t.classList.add("loading")},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,"Organiz: edit info"),t.classList.remove("loading"),raisoft.notification.notify({type:e.status,message:e.message}),134===parseInt(e.code)&&(o.getElementsByClassName("js-organization-info")[0].textContent=n,o.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),o.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide"))},error:function(e){raisoft.core.log("ajax error occur on updating client info","error","Organiz: edit info",e),t.classList.remove("loading")}};raisoft.ajax.send(s)},e.cover=function(e){var t=document.getElementById("organizationCover");raisoft.transport.init({url:"/transport/1",params:{id:e.dataset.pk},beforeSend:function(){var e=new FileReader,o=raisoft.transport.getInput(),n=o.files[0];e.readAsDataURL(n),e.onload=function(e){t.classList.add("image--loading"),t.src=e.target.result}},success:function(e){e=JSON.parse(e),raisoft.notification.notify({type:e.status,message:e.message}),88===parseInt(e.code)&&(t.src=e.url,t.classList.remove("image--loading"))},error:function(e){return raisoft.core.log("ajax error occur on updating organization cover","error","Organiz: edit info",e),!1}})},e}({})},19:function(e,t){e.exports=function(e){function t(){a=new FormData,s=c.dataset.offset,a.append("type",r),a.append("offset",s),a.append("csrf",document.getElementById("csrf").value);var e={url:"/organization/get",type:"POST",data:a,beforeSend:function(){u=!0,c.classList.remove("hide"),c.innerHTML="Загрузка ..."},success:function(e){e=JSON.parse(e),raisoft.core.log(e.message,e.status,n),u=!1,135===parseInt(e.code)?(a=null,c.classList.add("hide"),""!==e.html?(c.dataset.offset=parseInt(s)+2,l.innerHTML+=e.html):document.removeEventListener("scroll",o)):(c.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",raisoft.notification.notify({type:e.status,message:e.message}))},error:function(e){raisoft.core.log("ajax error occur on getting organizations","error",n,e),c.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",u=!1}};raisoft.ajax.send(e)}function o(){var e=l.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===u&&t()}var n="Organiz: get AJAX",a=null,r=null,s=null,i=null,l=null,c=null,u=null;return e.blocks=function(e){r=e.dataset.type,s=e.dataset.offset,i=e.dataset.search,c=e,l=document.getElementById("organizations"),(u=!1)||(t(),document.addEventListener("scroll",o))},e}({})},27:function(e,t,o){e.exports=function(e){return e.edit=o(18),e.coworker=o(17),e.get=o(19),e}({})}});