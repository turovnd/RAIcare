var organization=function(e){function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}var t={};return a.m=e,a.c=t,a.i=function(e){return e},a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},a.p="",a(a.s=212)}({186:function(e,a){e.exports=function(e){function a(e,a){for(var t="",o=0;o<e.length;o++)-1!==a.indexOf(e[o].id)?t+='<fieldset><div class="form-group"><input id="coWorkerPension'+o+'" name="pensions[]" type="checkbox" class="checkbox" value="'+e[o].id+'" checked data-name="'+e[o].name+'"><label for="coWorkerPension'+o+'" class="checkbox-label">'+e[o].name+"</label></div></fieldset>":t+='<fieldset><div class="form-group"><input id="coWorkerPatient'+o+'" name="patients" type="checkbox" class="checkbox" value="'+e[o].id+'" data-name="'+e[o].name+'"><label for="coWorkerPatient'+o+'" class="checkbox-label">'+e[o].name+"</label></div></fieldset>";return t}function t(){var e=document.getElementById("excludeForm"),a=new FormData;a.append("user",e.dataset.id),a.append("organization",n),a.append("csrf",document.getElementById("csrf").value);var t={url:"/organization/coworkerexclude",type:"POST",data:a,beforeSend:function(){e.classList.add("loading")},success:function(a){a=JSON.parse(a),raicare.core.log(a.message,a.status,o),e.classList.remove("loading"),raicare.notification.notify({type:a.status,message:a.message}),133===parseInt(a.code)&&(r.close(),document.getElementById("coWorkers").querySelector('.block[data-id="'+e.dataset.id+'"]').parentNode.remove())},error:function(a){raicare.core.log("ajax error occur on excluding coworker","error",o,a),e.classList.remove("loading")}};raicare.ajax.send(t)}var o="Org: coworker",n=document.getElementById("organizationID").value,r=null;return e.toggle=function(e){var a=e.closest(".js-field-name");a.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),a.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide")},e.save=function(e){var a=e.closest(".block"),t=e.closest(".js-field-name"),r=t.getElementsByClassName("form-group__control")[0].value,s=t.getElementsByClassName("form-group__control")[0].name,i=new FormData;i.append("id",a.dataset.id),i.append("csrf",document.getElementById("csrf").value),i.append("name",s),i.append("value",r),i.append("orgID",n);var c={url:"/organization/coworkerupdate",type:"POST",data:i,beforeSend:function(){a.classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,o),a.classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),53===parseInt(e.code)&&("role"===s?window.location.reload():t.getElementsByClassName("js-co-worker-info")[0].textContent=r,t.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),t.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide"))},error:function(e){raicare.core.log("ajax error occur on updating co-worker info","error",o,e),a.classList.remove("loading")}};raicare.ajax.send(c)},e.changePass=function(e){var a=e.closest(".block"),t=new FormData;t.append("id",a.dataset.id),t.append("csrf",document.getElementById("csrf").value),t.append("name","password"),t.append("orgID",n);var r={url:"/organization/coworkerupdate",type:"POST",data:t,beforeSend:function(){a.classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,o),a.classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),parseInt(e.code)},error:function(e){raicare.core.log("ajax error occur on updating co-worker password","error",o,e),a.classList.remove("loading")}};raicare.ajax.send(r)},e.pensionEdit=function(e){var t=JSON.parse(e.dataset.allpensions),o=JSON.parse(e.dataset.coworkerpensions);raicare.modal.create({id:"pensionEditModal",header:"Радактирование пансионатов",onclose:"remove",body:'<div class="p-b-5"><p class="text-bold">Выберите пансионаты, к которым имеет доступ сотрудник</p></div>'+a(t,o),footer:'<button type="button" class="btn btn--default" data-close="modal">Отмена</button><button onclick="organization.coworker.pensionSave()" type="button" class="btn btn--brand">Изменить</button>'}),document.getElementById("pensionEditModal").getElementsByClassName("modal__wrapper")[0].dataset.id=e.closest(".block").dataset.id},e.pensionSave=function(){var e=document.getElementById("pensionEditModal"),a=new FormData;e?e=e.getElementsByClassName("modal__wrapper")[0]:raicare.core.log("pensionEditModal not found in DOM","error",o),a.append("id",e.dataset.id),a.append("orgID",n),a.append("csrf",document.getElementById("csrf").value);for(var t=e.querySelectorAll("input:checked"),r=[],s=0;s<t.length;s++)r.push(t[s].value);a.append("pensions",JSON.stringify(r));var i={url:"/organization/coworkerpensions",type:"POST",data:a,beforeSend:function(){e.classList.add("loading")},success:function(a){if(a=JSON.parse(a),raicare.core.log(a.message,a.status,o),e.classList.remove("loading"),raicare.notification.notify({type:a.status,message:a.message}),147===parseInt(a.code)){var n=document.getElementById("coWorkers").querySelector('.block[data-id="'+e.dataset.id+'"]'),s=n.getElementsByClassName("coWorkerPensions__btn")[0],i=n.getElementsByClassName("coWorkerPensions__menu")[0],c="";s.dataset.coworkerpensions=JSON.stringify(r);for(var l=0;l<t.length;l++)c+='<li class="p-5">'+t[l].dataset.name+"</li>";console.log(n,i),i.innerHTML=c,raicare.modal.remove(document.getElementById("pensionEditModal"))}},error:function(a){raicare.core.log("ajax error occur on updating pensions info","error",o,a),e.classList.remove("loading")}};raicare.ajax.send(i)},e.invite=function(){var e=document.getElementById("newCoWorker"),a=new FormData(e);a.append("csrf",document.getElementById("csrf").value),a.append("orgID",n);var t={url:"/organization/coworkerinvite",type:"POST",data:a,beforeSend:function(){e.getElementsByClassName("modal__wrapper")[0].classList.add("loading")},success:function(a){a=JSON.parse(a),raicare.core.log(a.message,a.status,o),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading"),raicare.notification.notify({type:a.status,message:a.message}),134===parseInt(a.code)&&(e.reset(),raicare.modal.hide(e))},error:function(a){raicare.core.log("ajax error occur on inviting coworker","error",o,a),e.getElementsByClassName("modal__wrapper")[0].classList.remove("loading")}};raicare.ajax.send(t)},e.exclude=function(e){var a=e.closest(".block"),o=a.dataset.id,n=a.dataset.name;r=raicare.notification.notify({type:"confirm",message:'<form id="excludeForm" data-id="'+o+'"><h2>Исключить сотрудника</h2><p>Вы уверены, то хотите исключить '+n+"?</p><p>Исключив сотрудника, у него больше не будет доступа к организации.</p></form>",confirmText:"Исключить",showCancelButton:!0,validation:!0,confirm:t})},e}({})},187:function(e,a){e.exports=function(e){return e.toggle=function(e){var a=e.closest(".js-field-name");a.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),a.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide")},e.save=function(e){var a=document.getElementById("organization"),t=e.closest(".js-field-name"),o=t.getElementsByClassName("form-group__control")[0].value,n=t.getElementsByClassName("form-group__control")[0].name,r=new FormData;r.append("id",document.getElementById("organizationID").value),r.append("csrf",document.getElementById("csrf").value),r.append("name",n),r.append("value",o);var s={url:"/organization/update",type:"POST",data:r,beforeSend:function(){a.classList.add("loading")},success:function(e){e=JSON.parse(e),raicare.core.log(e.message,e.status,"Organiz: edit info"),a.classList.remove("loading"),raicare.notification.notify({type:e.status,message:e.message}),134===parseInt(e.code)&&(t.getElementsByClassName("js-organization-info")[0].textContent=o,t.getElementsByClassName("form-group__control-static")[0].classList.toggle("hide"),t.getElementsByClassName("form-group__control-group")[0].classList.toggle("hide"))},error:function(e){raicare.core.log("ajax error occur on updating organization info","error","Organiz: edit info",e),a.classList.remove("loading")}};raicare.ajax.send(s)},e.cover=function(e){var a=document.getElementById("organizationCover");raicare.transport.init({url:"/transport/1",params:{id:e.dataset.pk},beforeSend:function(){var e=new FileReader,t=raicare.transport.getInput(),o=t.files[0];e.readAsDataURL(o),e.onload=function(e){a.classList.add("image--loading"),a.src=e.target.result}},success:function(e){e=JSON.parse(e),88===parseInt(e.code)?(a.src=e.url,a.classList.remove("image--loading")):raicare.notification.notify({type:e.status,message:e.message})},error:function(e){return raicare.core.log("ajax error occur on updating organization cover","error","Organiz: edit info",e),!1}})},e}({})},188:function(e,a){e.exports=function(e){function a(){n=new FormData,s=l.dataset.offset,r=l.dataset.type;var e=i;n.append("name",i),n.append("type",r),n.append("offset",s),n.append("csrf",document.getElementById("csrf").value);var a={url:"/organization/get",type:"POST",data:n,beforeSend:function(){d=!0,l.innerHTML="Загрузка ..."},success:function(a){a=JSON.parse(a),raicare.core.log(a.message,a.status,o),d=!1,136===parseInt(a.code)?(n=null,l.innerHTML="Загрузить ещё",""!==a.html?(l.dataset.offset=parseInt(s)+parseInt(a.number),i===e?c.innerHTML+=a.html:c.innerHTML=a.html):(l.innerHTML="Всего "+parseInt(parseInt(s)+parseInt(a.number)),document.removeEventListener("scroll",t))):(l.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",raicare.notification.notify({type:a.status,message:a.message}))},error:function(e){raicare.core.log("ajax error occur on getting organizations","error",o,e),l.innerHTML="Ошибка при загрузке. <span class='link'>Повторить</span>",d=!1}};raicare.ajax.send(a)}function t(){var e=c.getBoundingClientRect().bottom;window.innerHeight-e>0&&!1===d&&a()}var o="Organiz: get AJAX",n=null,r=null,s=null,i="",c=document.getElementById("organizations"),l=document.getElementById("getMoreBtn"),d=!1;return e.search=function(e){i=e.value,d||(l.dataset.offset=0,c.innerHTML="",a())},e.blocks=function(e){l=e,d||(a(),document.addEventListener("scroll",t))},e}({})},212:function(e,a,t){e.exports=function(e){return e.edit=t(187),e.coworker=t(186),e.get=t(188),e}({})}});